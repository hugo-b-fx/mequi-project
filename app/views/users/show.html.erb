<%= render "shared/public_navbar" %>

<div class="rider-profile-page">
  <div class="profile-header">
    <div class="container">
      <div class="profile-header-content">
        <div class="profile-avatar">
          <% if @user.photo.attached? %>
            <%= image_tag @user.photo, alt: @user.full_name %>
          <% else %>
            <span class="avatar-initials"><%= @user.initials %></span>
          <% end %>
        </div>

        <div class="profile-info">
          <h1><%= @user.full_name %></h1>
          <div class="profile-meta">
            <span><i class="fas fa-horse"></i> <%= pluralize(@horses.count, "cheval", "chevaux") %></span>
            <span><i class="fas fa-graduation-cap"></i> <%= @total_lessons %> cours</span>
            <span><i class="fas fa-clock"></i> <%= @total_hours %>h</span>
          </div>
        </div>

        <% if user_signed_in? && current_user == @user %>
          <div class="profile-actions">
            <%= link_to edit_user_path(@user), class: "btn-profile-edit" do %>
              <i class="fas fa-pen"></i> Modifier
            <% end %>
            <%= link_to dashboard_user_path(@user), class: "btn-profile-dashboard" do %>
              <i class="fas fa-th-large"></i> Tableau de bord
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <div class="profile-content">
    <div class="container">
      <div class="profile-grid">
        <div class="profile-main">
          <div class="profile-card">
            <div class="stats-grid">
              <div class="stat-item">
                <span class="stat-value"><%= @total_lessons %></span>
                <span class="stat-label">Cours</span>
              </div>
              <div class="stat-item">
                <span class="stat-value"><%= @total_hours %>h</span>
                <span class="stat-label">Entraînement</span>
              </div>
              <div class="stat-item">
                <span class="stat-value"><%= @horses.count %></span>
                <span class="stat-label">Chevaux</span>
              </div>
              <div class="stat-item">
                <span class="stat-value"><%= @user.favorite_discipline %></span>
                <span class="stat-label">Discipline</span>
              </div>
            </div>
          </div>

          <% if @user.bio.present? %>
            <div class="profile-card">
              <h2><i class="fas fa-user"></i> À propos</h2>
              <p class="bio-text"><%= simple_format(@user.bio) %></p>
            </div>
          <% end %>

          <div class="profile-card">
            <div class="card-header-row">
              <h2><i class="fas fa-horse"></i> Mes chevaux</h2>
              <% if user_signed_in? && current_user == @user %>
                <%= link_to new_horse_path, class: "btn-add" do %>
                  <i class="fas fa-plus"></i> Ajouter
                <% end %>
              <% end %>
            </div>

            <% if @horses.any? %>
              <div class="horses-list">
                <% @horses.each do |horse| %>
                  <div class="horse-item">
                    <div class="horse-photo">
                      <% if horse.photos.attached? %>
                        <%= image_tag horse.primary_photo, alt: horse.name %>
                      <% else %>
                        <i class="fas fa-horse"></i>
                      <% end %>
                    </div>
                    <div class="horse-details">
                      <h3><%= horse.name %></h3>
                      <div class="horse-tags">
                        <% if horse.breed.present? %>
                          <span class="tag"><%= horse.breed %></span>
                        <% end %>
                        <% if horse.age.present? %>
                          <span class="tag"><%= horse.age_display %></span>
                        <% end %>
                        <% if horse.discipline.present? %>
                          <span class="tag"><%= horse.discipline %></span>
                        <% end %>
                      </div>
                    </div>
                    <% if user_signed_in? && current_user == @user %>
                      <%= link_to edit_horse_path(horse), class: "horse-edit-btn" do %>
                        <i class="fas fa-pen"></i>
                      <% end %>
                    <% end %>
                  </div>
                <% end %>
              </div>
            <% else %>
              <div class="empty-state">
                <i class="fas fa-horse"></i>
                <p>Aucun cheval enregistré</p>
                <% if user_signed_in? && current_user == @user %>
                  <%= link_to new_horse_path, class: "btn-add-first" do %>
                    <i class="fas fa-plus"></i> Ajouter mon premier cheval
                  <% end %>
                <% end %>
              </div>
            <% end %>
          </div>

          <% if @completed_bookings.any? %>
            <div class="profile-card">
              <h2><i class="fas fa-history"></i> Cours récents</h2>
              <div class="bookings-list">
                <% @completed_bookings.each do |booking| %>
                  <div class="booking-item">
                    <div class="booking-icon">
                      <i class="fas fa-check"></i>
                    </div>
                    <div class="booking-details">
                      <strong>Cours avec <%= booking.coach.full_name %></strong>
                      <span><%= l(booking.start_at, format: :long) %></span>
                    </div>
                    <% if booking.review.present? %>
                      <div class="booking-rating">
                        <i class="fas fa-star"></i> <%= booking.review.rating %>/5
                      </div>
                    <% end %>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>

        <div class="profile-sidebar">
          <% if user_signed_in? && current_user != @user && current_user.coach? %>
            <div class="profile-card contact-card">
              <h3>Contacter <%= @user.first_name %></h3>
              <%= link_to "#", class: "btn-contact" do %>
                <i class="fas fa-envelope"></i> Envoyer un message
              <% end %>
            </div>
          <% end %>

          <% if @reviews_given.any? %>
            <div class="profile-card">
              <h3><i class="fas fa-comment"></i> Avis laissés</h3>
              <div class="reviews-list">
                <% @reviews_given.each do |review| %>
                  <div class="review-item">
                    <div class="review-header">
                      <span class="review-coach">Coach: <%= review.booking.coach.full_name %></span>
                      <span class="review-stars"><%= '★' * review.rating.to_i %></span>
                    </div>
                    <p>"<%= truncate(review.comment, length: 80) %>"</p>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>

          <% if user_signed_in? && current_user == @user %>
            <div class="profile-card">
              <h3><i class="fas fa-bolt"></i> Accès rapide</h3>
              <div class="quick-links">
                <%= link_to coaches_path, class: "quick-link" do %>
                  <i class="fas fa-search"></i> Trouver un coach
                <% end %>
                <%= link_to new_horse_path, class: "quick-link" do %>
                  <i class="fas fa-plus"></i> Ajouter un cheval
                <% end %>
                <%= link_to dashboard_user_path(@user), class: "quick-link" do %>
                  <i class="fas fa-calendar"></i> Mon agenda
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
